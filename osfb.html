<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Falling Blocks</title>
<style type="text/css">
* { margin: 0; padding: 0; border: 0; }
.row { height: 20px; }
span { width: 20px; height: 20px; display: inline-block; }
.i { background: cyan; }
.j { background: blue; }
.l { background: orange; }
.o { background: yellow; }
.s { background: lime; }
.t { background: purple; }
.z { background: red; }
#playfield { background: black; width: 200px; margin-left: auto; margin-right: auto; }
</style>
<script type="text/javascript">
var fieldwidth = 10;
var fieldheight = 20;
var currentpiece = undefined;
var timer;

function nextpiece() {
	var pieces = [ 'i', 'j', 'l', 'o', 's', 't', 'z' ];
	var piece = {};
	piece.type = pieces[Math.floor(Math.random() * pieces.length)];
	piece.left = fieldwidth;
	piece.right = 0;
	piece.top = fieldheight;
	piece.bottom = 0;
	switch (piece.type) {
		case 'i': piece[0] = { y: 0, x: 4 }; piece[1] = { y: 1, x: 4 }; piece[2] = { y: 2, x: 4 }; piece[3] = { y: 3, x: 4 }; break;
		case 'j': piece[0] = { y: 0, x: 3 }; piece[1] = { y: 0, x: 4 }; piece[2] = { y: 0, x: 5 }; piece[3] = { y: 1, x: 5 }; break;
		case 'l': piece[0] = { y: 0, x: 3 }; piece[1] = { y: 0, x: 4 }; piece[2] = { y: 0, x: 5 }; piece[3] = { y: 1, x: 3 }; break;
		case 'o': piece[0] = { y: 0, x: 4 }; piece[1] = { y: 0, x: 5 }; piece[2] = { y: 1, x: 4 }; piece[3] = { y: 1, x: 5 }; break;
		case 's': piece[0] = { y: 0, x: 4 }; piece[1] = { y: 0, x: 5 }; piece[2] = { y: 1, x: 3 }; piece[3] = { y: 1, x: 4 }; break;
		case 't': piece[0] = { y: 0, x: 3 }; piece[1] = { y: 0, x: 4 }; piece[2] = { y: 0, x: 5 }; piece[3] = { y: 1, x: 4 }; break;
		case 'z': piece[0] = { y: 0, x: 3 }; piece[1] = { y: 0, x: 4 }; piece[2] = { y: 1, x: 4 }; piece[3] = { y: 1, x: 5 }; break;
	}
	for (var i = 0; i < 4; i++) {
		if (piece[i].y < piece.top) { piece.top = piece[i].y; } else if (piece[i].y > piece.bottom) { piece.bottom = piece[i].y; }
		if (piece[i].x < piece.left) { piece.left = piece[i].x; } else if (piece[i].x > piece.right) { piece.right = piece[i].x; }
	}
	//console.log(piece);
	return piece;
}

function cleartimer() { window.clearInterval(timer); }
function settimer() { timer = window.setInterval(advance, 500); }
function getblock(y, x) { return document.getElementById(y + "-" + x); }
function clearblock(y, x) { getblock(y, x).className = ""; }
function setblock(y, x, t) { getblock(y, x).className = t; }

function advance() {
	if (currentpiece == undefined) {
		currentpiece = nextpiece();
	} else {
		for (var block = 0; block < 4; block++) {
			if (currentpiece[block].y == currentpiece.bottom && currentpiece[block].y + 1 >= fieldheight) {
				currentpiece = nextpiece();
			}
			if (currentpiece[block].y == currentpiece.bottom && getblock(currentpiece[block].y + 1, currentpiece[block].x).className != "") {
				var b = getblock(currentpiece[block].y + 1, currentpiece[block].x);
				currentpiece = nextpiece();
			}
		}
		
		for (var block = 0; block < 4; block++) {
			clearblock(currentpiece[block].y, currentpiece[block].x);
		}
		
	}

	currentpiece.top++;
	currentpiece.bottom++;
	for (var block = 0; block < 4; block++) {
		currentpiece[block].y++;
		setblock(currentpiece[block].y, currentpiece[block].x, currentpiece.type);
	}
}

function left() {
	cleartimer();
	for (var block = 0; block < 4; block++) {
		if (currentpiece[block].x < 1) {
			return;
		}
		if (currentpiece[block].x == currentpiece.left && getblock(currentpiece[block].y, currentpiece[block].x - 1).className != "") {
			return;
		}
	}
	currentpiece.left--;
	currentpiece.right--;
	for (var block = 0; block < 4; block++) {
		clearblock(currentpiece[block].y, currentpiece[block].x);
		currentpiece[block].x--;
		setblock(currentpiece[block].y, currentpiece[block].x, currentpiece.type);
	}
	settimer();
}

function right() {
	cleartimer();
	for (var block = 0; block < 4; block++) {
		if (currentpiece[block].x+1 >= fieldwidth) {
			return;
		}
		if (currentpiece[block].x == currentpiece.right && getblock(currentpiece[block].y, currentpiece[block].x + 1).className != "") {
			return;
		}
	}
	currentpiece.left++;
	currentpiece.right++;
	for (var block = 0; block < 4; block++) {
		clearblock(currentpiece[block].y, currentpiece[block].x);
		currentpiece[block].x++;
		setblock(currentpiece[block].y, currentpiece[block].x, currentpiece.type);
	}
	settimer();
}

function softdrop() {
	cleartimer();
	advance();
	settimer();
}

function harddrop() {
}

function clockwise() {
}

function counterclockwise() {
}

function startgame() {
	timer = window.setInterval(advance, 500);
}

function quitgame() {
	window.clearTimetout(timer);
}

function init() {
	window.onkeydown = function(e) {
		var key = e.keyCode ? e.keyCode : e.which;
		switch (key) {
		case 32: /* space */
			clockwise();
			break;

		case 13: /* enter */
		case 83: /* 's' */
			startgame();
			break;

		case 27: /* escape */
			quitgame();
			break;
		
		case 37: left(); break;
		case 38: harddrop(); break;
		case 39: right(); break;
		case 40: softdrop(); break;
                default:
			console.log(key);
                        return false;
                }
        }
	
}
</script>
</head>
<body onload="init();">
<div id="playfield">
<div class="row"><span id="0-0"></span><span id="0-1"></span><span id="0-2"></span><span id="0-3"></span><span id="0-4"></span><span id="0-5"></span><span id="0-6"></span><span id="0-7"></span><span id="0-8"></span><span id="0-9"></span></div>
<div class="row"><span id="1-0"></span><span id="1-1"></span><span id="1-2"></span><span id="1-3"></span><span id="1-4"></span><span id="1-5"></span><span id="1-6"></span><span id="1-7"></span><span id="1-8"></span><span id="1-9"></span></div>
<div class="row"><span id="2-0"></span><span id="2-1"></span><span id="2-2"></span><span id="2-3"></span><span id="2-4"></span><span id="2-5"></span><span id="2-6"></span><span id="2-7"></span><span id="2-8"></span><span id="2-9"></span></div>
<div class="row"><span id="3-0"></span><span id="3-1"></span><span id="3-2"></span><span id="3-3"></span><span id="3-4"></span><span id="3-5"></span><span id="3-6"></span><span id="3-7"></span><span id="3-8"></span><span id="3-9"></span></div>
<div class="row"><span id="4-0"></span><span id="4-1"></span><span id="4-2"></span><span id="4-3"></span><span id="4-4"></span><span id="4-5"></span><span id="4-6"></span><span id="4-7"></span><span id="4-8"></span><span id="4-9"></span></div>
<div class="row"><span id="5-0"></span><span id="5-1"></span><span id="5-2"></span><span id="5-3"></span><span id="5-4"></span><span id="5-5"></span><span id="5-6"></span><span id="5-7"></span><span id="5-8"></span><span id="5-9"></span></div>
<div class="row"><span id="6-0"></span><span id="6-1"></span><span id="6-2"></span><span id="6-3"></span><span id="6-4"></span><span id="6-5"></span><span id="6-6"></span><span id="6-7"></span><span id="6-8"></span><span id="6-9"></span></div>
<div class="row"><span id="7-0"></span><span id="7-1"></span><span id="7-2"></span><span id="7-3"></span><span id="7-4"></span><span id="7-5"></span><span id="7-6"></span><span id="7-7"></span><span id="7-8"></span><span id="7-9"></span></div>
<div class="row"><span id="8-0"></span><span id="8-1"></span><span id="8-2"></span><span id="8-3"></span><span id="8-4"></span><span id="8-5"></span><span id="8-6"></span><span id="8-7"></span><span id="8-8"></span><span id="8-9"></span></div>
<div class="row"><span id="9-0"></span><span id="9-1"></span><span id="9-2"></span><span id="9-3"></span><span id="9-4"></span><span id="9-5"></span><span id="9-6"></span><span id="9-7"></span><span id="9-8"></span><span id="9-9"></span></div>
<div class="row"><span id="10-0"></span><span id="10-1"></span><span id="10-2"></span><span id="10-3"></span><span id="10-4"></span><span id="10-5"></span><span id="10-6"></span><span id="10-7"></span><span id="10-8"></span><span id="10-9"></span></div>
<div class="row"><span id="11-0"></span><span id="11-1"></span><span id="11-2"></span><span id="11-3"></span><span id="11-4"></span><span id="11-5"></span><span id="11-6"></span><span id="11-7"></span><span id="11-8"></span><span id="11-9"></span></div>
<div class="row"><span id="12-0"></span><span id="12-1"></span><span id="12-2"></span><span id="12-3"></span><span id="12-4"></span><span id="12-5"></span><span id="12-6"></span><span id="12-7"></span><span id="12-8"></span><span id="12-9"></span></div>
<div class="row"><span id="13-0"></span><span id="13-1"></span><span id="13-2"></span><span id="13-3"></span><span id="13-4"></span><span id="13-5"></span><span id="13-6"></span><span id="13-7"></span><span id="13-8"></span><span id="13-9"></span></div>
<div class="row"><span id="14-0"></span><span id="14-1"></span><span id="14-2"></span><span id="14-3"></span><span id="14-4"></span><span id="14-5"></span><span id="14-6"></span><span id="14-7"></span><span id="14-8"></span><span id="14-9"></span></div>
<div class="row"><span id="15-0"></span><span id="15-1"></span><span id="15-2"></span><span id="15-3"></span><span id="15-4"></span><span id="15-5"></span><span id="15-6"></span><span id="15-7"></span><span id="15-8"></span><span id="15-9"></span></div>
<div class="row"><span id="16-0"></span><span id="16-1"></span><span id="16-2"></span><span id="16-3"></span><span id="16-4"></span><span id="16-5"></span><span id="16-6"></span><span id="16-7"></span><span id="16-8"></span><span id="16-9"></span></div>
<div class="row"><span id="17-0"></span><span id="17-1"></span><span id="17-2"></span><span id="17-3"></span><span id="17-4"></span><span id="17-5"></span><span id="17-6"></span><span id="17-7"></span><span id="17-8"></span><span id="17-9"></span></div>
<div class="row"><span id="18-0"></span><span id="18-1"></span><span id="18-2"></span><span id="18-3"></span><span id="18-4"></span><span id="18-5"></span><span id="18-6"></span><span id="18-7"></span><span id="18-8"></span><span id="18-9"></span></div>
<div class="row"><span id="19-0"></span><span id="19-1"></span><span id="19-2"></span><span id="19-3"></span><span id="19-4"></span><span id="19-5"></span><span id="19-6"></span><span id="19-7"></span><span id="19-8"></span><span id="19-9"></span></div>
</div>
</body>
</html>
